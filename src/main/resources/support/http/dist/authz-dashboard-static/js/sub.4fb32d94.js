(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["sub"],{"1c6d":function(e,t,s){"use strict";s("885f")},"3d70":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"device"}},[t("device-list",{attrs:{blacklist:e.blacklist}})],1)},a=[],r=(s("6742"),function(){var e=this,t=e._self._c;return t("div",[e.loading?e._e():t("a-list",{attrs:{"item-layout":"horizontal",size:"large",pagination:e.pagination,"data-source":e.devices},scopedSlots:e._u([{key:"renderItem",fn:function(s,i){return t("a-list-item",{key:"item.issueTokenId"},[t("template",{slot:"actions"},[t("span",{staticClass:"hover-hand hover-color-green",on:{click:function(t){return e.onlyLook(s.userId)}}},[t("a-icon",{staticStyle:{"margin-right":"8px"},style:e.onlylook?"color: green":"",attrs:{type:"pushpin"}}),e._v(" "+e._s(e.onlylook?"查看全部用户":"只看该用户")+" ")],1),t("span",{staticClass:"hover-hand hover-color-purple",on:{click:function(t){return e.checkLogin(s.userId,s.id,s.deviceType,s.deviceId)}}},[t("a-icon",{staticStyle:{"margin-right":"8px"},attrs:{type:"bug"}}),e._v(" 登录检查 ")],1),t("span",{staticClass:"hover-hand hover-color-yellow",on:{click:function(t){return e.logout(s.userId,s.id,s.deviceType,s.deviceId)}}},[t("a-icon",{staticStyle:{"margin-right":"8px"},attrs:{type:"logout"}}),e._v(" 下线 ")],1),t("span",{staticClass:"hover-hand hover-color-red",on:{click:function(t){return e.ban(s.userId,s.id,s.deviceType,s.deviceId,s.lastRequestIp)}}},[t("a-icon",{staticStyle:{"margin-right":"8px"},attrs:{type:"disconnect"}}),e._v(" 封号 ")],1)]),t("a-list-item-meta",[t("div",{attrs:{slot:"title"},slot:"title"},[t("sapn",{class:{deny:s.denyUser,live:!s.denyUser&&e.allUserid.includes(s.userId)}},[e._v("用户Id："+e._s(s.userId))]),s.deviceType?t("span",{class:{deny:s.denyDevice},staticStyle:{"margin-left":"10px"}},[e._v("设备Type："+e._s(s.deviceType))]):e._e(),s.deviceId?t("span",{class:{deny:s.denyDevice},staticStyle:{"margin-left":"10px"}},[e._v("设备ID："+e._s(s.deviceId))]):e._e()],1),t("div",{attrs:{slot:"description"},slot:"description"},[t("span",{staticClass:"description-item"},[e._v("最后一次访问时间："+e._s(s.lastRequestTime))]),t("span",{staticClass:"description-item",class:s.denyIp?"deny":""},[e._v("最后一次访问IP："+e._s(s.lastRequestIp))]),t("span",{staticClass:"description-item"},[e._v("登录标识："+e._s(s.id))]),s.denyIpRange?t("span",{staticClass:"deny"},[e._v("此网段被封禁")]):e._e()])])],2)}}],null,!1,15986698)},[t("div",{attrs:{slot:"footer"},slot:"footer"},[t("b",[e._v("有效登录用户数量（共："+e._s(e.allUserid.length)+" "),t("span",{staticStyle:{"margin-left":"5px"}},[e._v("个")]),e._v("）")]),e._v(" "),t("span",{staticStyle:{color:"#e8cccc","margin-right":"10px"}},[e._v(" | ")]),e._v(" "),t("b",[e._v("最近访问设备（共："+e._s(e.devices.length)+" "),t("span",{staticStyle:{"margin-left":"5px"}},[e._v("个")]),e._v("）")]),e._v(" - 近2天 "),t("span",{staticClass:"hover-color-yellow",staticStyle:{"margin-left":"5px",cursor:"pointer"},on:{click:e.reload}},[t("a-icon",{attrs:{type:"sync"}})],1)]),t("a-drawer",{attrs:{placement:"right",closable:!1,title:"封号",width:720,visible:e.show,"body-style":{paddingBottom:"80px"}},on:{close:e.onClose}},[t("a-row",[t("h3",[e._v(" 用户信息 ")]),t("a-col",{style:e.pStyle,attrs:{span:24}},[t("b",{staticStyle:{"margin-right":"10px"}},[e._v("用户id：")]),e._v(e._s(e.curUser.userId)+" ")]),t("a-col",{style:e.pStyle,attrs:{span:24}},[t("b",{staticStyle:{"margin-right":"10px"}},[e._v("登录标识: ")]),e._v(" "+e._s(e.curUser.id)+" ")]),t("a-col",{style:e.pStyle,attrs:{span:24}},[t("b",{staticStyle:{"margin-right":"10px"}},[e._v("最后一次访问IP: ")]),e._v(" "+e._s(e.curUser.ip)+" ")]),t("a-col",{style:e.pStyle,attrs:{span:24}},[t("b",{staticStyle:{"margin-right":"10px"}},[e._v("设备Type: ")]),e._v(" "+e._s(e.curUser.deviceType)+" ")]),e.curUser.deviceId?t("a-col",{style:e.pStyle,attrs:{span:24}},[t("b",{staticStyle:{"margin-right":"10px"}},[e._v("设备ID: ")]),e._v(" "+e._s(e.curUser.deviceId)+" ")]):e._e()],1),e.curUser.deny?t("a-divider"):e._e(),e.curUser.deny?t("a-row",[t("h3",[e._v(" 封禁信息 ")]),t("a-col",{style:e.pStyle,attrs:{span:24}},[t("b",[e._v("用户信息: ")]),e.curUser.deny.userId?t("div",{staticClass:"deny-inner-info"},[t("span",[e._v("用户id：")]),e._v(" "+e._s(e.curUser.deny.userId.userId)+" "),t("br"),t("span",[e._v("结束时间：")]),e._v(" "+e._s(e.curUser.deny.userId.timeMeta.end)+" "),t("br"),t("span",[e._v("封禁时长（开始到结束）:")]),e._v(" "+e._s(e.curUser.deny.userId.timeMeta.time)+" "),t("span",{staticClass:"deny-inner-info-button",on:{click:e.removeUserDeny}},[t("a-icon",{attrs:{type:"delete"}}),e._v("移除")],1),e._v(" "),t("br")]):t("div",{staticClass:"deny-inner-info"},[e._v(" 无 ")])]),t("a-col",{style:e.pStyle,attrs:{span:24}},[t("b",[e._v("设备信息：")]),e.curUser.deny.device?t("div",{staticClass:"deny-inner-info"},[t("span",[e._v("封禁设备Type：")]),e._v(" "+e._s(e.curUser.deny.device.deviceType)+" "),t("br"),t("span",[e._v("封禁设备Id：")]),e._v(" "+e._s(e.curUser.deny.device.deviceId)+" "),t("br"),t("span",[e._v("结束时间：")]),e._v(" "+e._s(e.curUser.deny.device.timeMeta.end)+" "),t("br"),t("span",[e._v("封禁时长（开始到结束）:")]),e._v(" "+e._s(e.curUser.deny.device.timeMeta.time)+" "),t("span",{staticClass:"deny-inner-info-button",on:{click:e.removeDeviceDeny}},[t("a-icon",{attrs:{type:"delete"}}),e._v("移除")],1),e._v(" "),t("br")]):t("div",{staticClass:"deny-inner-info"},[e._v(" 无 ")])]),t("a-col",{style:e.pStyle,attrs:{span:24}},[t("b",[e._v("ip信息: ")]),e.curUser.deny.ip?t("div",{staticClass:"deny-inner-info"},[t("span",[e._v("封禁ip：")]),e._v(" "+e._s(e.curUser.deny.ip.ip)+" "),t("br"),t("span",[e._v("结束时间：")]),e._v(" "+e._s(e.curUser.deny.ip.timeMeta.end)+" "),t("br"),t("span",[e._v("封禁时长（开始到结束）:")]),e._v(" "+e._s(e.curUser.deny.ip.timeMeta.time)+" "),t("span",{staticClass:"deny-inner-info-button",on:{click:e.removeIpDeny}},[t("a-icon",{attrs:{type:"delete"}}),e._v("移除")],1),e._v(" "),t("br")]):t("div",{staticClass:"deny-inner-info"},[e._v(" 无 ")])])],1):e._e(),t("a-divider"),t("a-form",{attrs:{form:e.form,layout:"vertical","hide-required-mark":""},on:{submit:e.handleSubmit}},[t("a-row",{attrs:{gutter:16}},[t("a-col",{attrs:{span:12}},[t("a-form-item",{attrs:{label:"封禁类型"}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["type",{rules:[{required:!0,message:"请选择封禁类型"}]}],expression:"[\n                  'type',\n                  {\n                    rules: [{ required: true, message: '请选择封禁类型' }],\n                  },\n                ]"}],attrs:{placeholder:"封禁类型"}},[t("a-select-option",{attrs:{value:"ip"}},[e._v(" IP ")]),t("a-select-option",{attrs:{value:"user"}},[e._v(" User ")]),t("a-select-option",{attrs:{value:"device"},on:{select:function(e){}}},[e._v(" Device ")])],1)],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-item",{attrs:{label:"结束时间"}},[t("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["denyEndDateTime",{rules:[{required:!0,message:"请选择结束时间"}]}],expression:"[\n                  'denyEndDateTime',\n                  {\n                    rules: [{ required: true, message: '请选择结束时间' }],\n                  },\n                ]"}],staticStyle:{width:"100%"},attrs:{placeholder:"结束时间","get-popup-container":e=>e.parentNode,"show-time":""}},[t("template",{slot:"renderExtraFooter"},[e._v(" 解除封禁的时间 ")])],2)],1)],1)],1)],1),t("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right",zIndex:1}},[t("a-button",{style:{marginRight:"8px"},on:{click:e.onClose}},[e._v(" 取消 ")]),t("a-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v(" 提交 ")])],1)],1)],1),e.loading?t("a-skeleton",{attrs:{title:!1,active:""}}):e._e(),e.loading?t("a-skeleton",{attrs:{title:!1,active:""}}):e._e(),e.loading?t("a-skeleton",{attrs:{title:!1,active:""}}):e._e()],1)}),n=[],c={name:"DeviceList",components:{},props:{blacklist:{}},data(){return{show:!1,pStyle:{marginTop:"12px"},loading:!0,rawDevices:[],curUser:{},form:this.$form.createForm(this),onlylook:!1,allUserid:[],devices:[{deviceType:"",deviceId:"",userId:"",lastRequestTime:null,lastRequestIp:"",id:""}],userBlacklist:[],ipBlacklist:[],iprangeBlacklist:[],pagination:{onChange:e=>{},pageSize:8}}},methods:{removeUserDeny(){this.removeDeny("user")},removeDeviceDeny(){this.removeDeny("device")},removeIpDeny(){this.removeDeny("ip")},removeDeny(e){let t={userId:this.curUser.userId,deviceType:this.curUser.deviceType,deviceId:this.curUser.deviceId,ip:this.curUser.ip,type:e};this.$http.post("/device/deny-remove",t).then(e=>{100===e.code?(this.$set(this.curUser,"deny",e.data),this.reload(),this.reloadDenyInfo(),this.$message.success("ok")):this.$message.success("error")})},reloadDenyInfo(){let e={userId:this.curUser.userId,deviceType:this.curUser.deviceType,deviceId:this.curUser.deviceId,ip:this.curUser.ip};this.$http.post("/device/get-deny-info",e).then(e=>{100===e.code&&this.$set(this.curUser,"deny",e.data)})},handleSubmit(e){e.preventDefault(),this.form.validateFields((e,t)=>{if(!e){let e={date:t.denyEndDateTime.format("YYYY-MM-DD HH:mm:ss"),type:t.type};"ip"===e.type&&(e.ip=this.curUser.ip),"user"!==e.type&&"device"!==e.type||(e.userId=this.curUser.userId),"device"===e.type&&(e.deviceType=this.curUser.deviceType,e.deviceId=this.curUser.deviceId),this.$http.post("/device/deny",e).then(e=>{100===e.code&&(this.$message.success("成功"),this.reload(),this.reloadDenyInfo())}),this.form=this.$form.createForm(this)}})},ban(e,t,s,i,a){let r={userId:e,deviceType:s,deviceId:i,ip:a};this.curUser={...r,id:t},this.reloadDenyInfo(),this.form=this.$form.createForm(this),this.show=!0},onClose(){this.show=!1},onlyLook(e){this.onlylook?(this.onlylook=!1,this.devices=this.rawDevices):(this.onlylook=!0,this.devices=this.rawDevices.filter(t=>t.userId===e))},logout(e,t,s,i){const a=this.$createElement;this.$http.get("/device/logout",{params:{userId:e,id:t}}).then(t=>{100===t.code&&this.$message.success(a("div",[a("div",[" 用户id：",e," "]),a("div",["设备: ",s," - ",i," 已下线"])]))}),this.$http.get("/device/get-all-userid").then(e=>{this.allUserid=e.data})},checkLogin(e,t,s,i){const a=this.$createElement;this.$http.get("/device/check-is-login",{params:{userId:e,id:t}}).then(r=>{!0===r.data?this.$message.success(a("div",[a("div",[" 用户id：",e," 登录标识：",t," "]),a("div",["设备: ",s," - ",i," 登录有效"])])):this.$message.warn(a("div",[a("div",[" 用户id：",e," 登录标识：",t," "]),a("div",["设备: ",s," - ",i," 此登录失效"])]))})},reload(){this.loading=!0,this.$http.get("/device/active-users",{params:{time:"2d"}}).then(e=>{this.rawDevices=e.data,this.devices=e.data,this.loading=!1})}},mounted(){this.$http.get("/device/active-users",{params:{time:"2d"}}).then(e=>{this.rawDevices=e.data,this.devices=e.data,this.loading=!1}),this.$http.get("/device/get-all-userid").then(e=>{this.allUserid=e.data})}},d=c,o=(s("1c6d"),s("0b56")),l=Object(o["a"])(d,r,n,!1,null,"73e145d8",null),v=l.exports,p={name:"Device",components:{DeviceList:v},data(){return{blacklist:{}}},mounted(){this.$http.get("/device/get-all-deny-info").then(e=>{this.blacklist=e.data})},methods:{}},u=p,h=(s("84a0"),Object(o["a"])(u,i,a,!1,null,"0e5d2d10",null));t["default"]=h.exports},"517a":function(e,t,s){},"67e1":function(e,t,s){},"7ff1":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e._self._c;return t("div",[e._v(" 黑名单管理 ")])},a=[],r={name:"Blacklist",data(){return{}},methods:{}},n=r,c=s("0b56"),d=Object(c["a"])(n,i,a,!1,null,"57d43481",null);t["default"]=d.exports},"84a0":function(e,t,s){"use strict";s("517a")},"885f":function(e,t,s){},9352:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this;e._self._c;return e._m(0)},a=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"data-perm"},[t("div",{staticClass:"info"},[e._v(" Data permissions dashboard coming soon... ")])])}],r={name:"Data",data(){return{}},methods:{}},n=r,c=(s("b8e8"),s("0b56")),d=Object(c["a"])(n,i,a,!1,null,"07572bad",null);t["default"]=d.exports},b8e8:function(e,t,s){"use strict";s("67e1")}}]);